var w=Object.defineProperty;var b=(n,t,e)=>t in n?w(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var i=(n,t,e)=>(b(n,typeof t!="symbol"?t+"":t,e),e);/* empty css      */const c={brain:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 3c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2m0 10c3.3 0 6-2.7 6-6s-2.7-6-6-6-6 2.7-6 6 2.7 6 6 6m0-8c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2m8.4 15.7l-3.6-3.6c-.2-.2-.5-.3-.8-.3h-8c-.3 0-.6.1-.8.3l-3.6 3.6c-.3.3-.3.8 0 1.1.3.3.8.3 1.1 0l3.3-3.3h7.8l3.3 3.3c.3.3.8.3 1.1 0 .3-.3.3-.8 0-1.1z"/></svg>',summary:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M14 17h-7c-.6 0-1-.4-1-1s.4-1 1-1h7c.6 0 1 .4 1 1s-.4 1-1 1zm3-4h-10c-.6 0-1-.4-1-1s.4-1 1-1h10c.6 0 1 .4 1 1s-.4 1-1 1zm0-4h-10c-.6 0-1-.4-1-1s.4-1 1-1h10c.6 0 1 .4 1 1s-.4 1-1 1z"/></svg>',key:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12.65 10C11.83 7.67 9.61 6 7 6c-3.31 0-6 2.69-6 6s2.69 6 6 6c2.61 0 4.83-1.67 5.65-4H17v4h4v-4h2v-4H12.65zM7 14c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"/></svg>',transcript:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"/></svg>',comments:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M21 6h-2v9H6v2c0 .55.45 1 1 1h11l4 4V7c0-.55-.45-1-1-1zm-4 6V3c0-.55-.45-1-1-1H3c-.55 0-1 .45-1 1v14l4-4h10c.55 0 1-.45 1-1z"/></svg>',export:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M19 12v7H5v-7H3v7c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zm-6 .67l2.59-2.58L17 11.5l-5 5-5-5 1.41-1.41L11 12.67V3h2z"/></svg>',filter:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z"/></svg>',link:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/></svg>',text:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M2.5 4v3h5v12h3V7h5V4h-13zm19 5h-9v3h3v7h3v-7h3V9z"/></svg>',clock:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/></svg>'};class f{constructor(t){i(this,"button");this.button=document.createElement("button"),this.button.className="youtube-summary-button",this.button.innerHTML=`${c.brain} Résumer la vidéo`,this.button.onclick=t}getElement(){return this.button}disable(){this.button.disabled=!0,this.button.innerHTML=`${c.brain} Génération en cours...`}enable(){this.button.disabled=!1,this.button.innerHTML=`${c.brain} Résumer la vidéo`}hide(){this.button.style.display="none"}show(){this.button.style.display="flex"}}class C{constructor(){i(this,"element");i(this,"loadingElement");i(this,"contentList");this.element=document.createElement("div"),this.element.className="youtube-summary-content",this.loadingElement=this.createLoadingElement(),this.contentList=this.createContentList(),this.element.appendChild(this.loadingElement),this.element.appendChild(this.contentList)}createLoadingElement(){const t=document.createElement("div");t.className="youtube-summary-loading";const e=document.createElement("div");e.className="loading-spinner",t.appendChild(e);const s=document.createElement("div");return s.className="loading-text",s.textContent="Génération du résumé en cours...",t.appendChild(s),t}createContentList(){const t=document.createElement("ul");return t.className="youtube-summary-list",t}getElement(){return this.element}showLoading(){this.contentList.style.display="none",this.loadingElement.classList.add("show")}hideLoading(){this.loadingElement.classList.remove("show"),this.contentList.style.display="block"}render(t){this.hideLoading(),this.contentList.innerHTML="",t.forEach(e=>{const s=document.createElement("li");s.className="youtube-summary-item",s.textContent=e,this.contentList.appendChild(s)})}showError(t){this.hideLoading(),this.contentList.innerHTML=`
      <div class="youtube-summary-error">
        ${t}
      </div>
    `}}const r=class r{constructor(){i(this,"apiUrl","http://localhost:5000/api/summarize")}static getInstance(){return r.instance||(r.instance=new r),r.instance}async fetchSummary(t){try{const s=await(await fetch(this.apiUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({videoId:t,targetLang:"fr"})})).json();return{summary:Array.isArray(s.summary)?s.summary:s.summary.split(`
`).map(o=>o.trim()).filter(o=>o.length>0),timestampedSummary:["00:00 Introduction","00:30 Faits importants","01:10 Analyse politique"],transcript:["00:00 Lorem ipsum dolor sit amet...","00:41 Consectetur adipiscing elit...","01:22 Sed do eiusmod tempor incididunt..."],comments:["Super vidéo, très instructif !","Excellente analyse des événements.","Merci pour ces explications détaillées."]}}catch(e){return console.error("Erreur lors de la récupération du résumé :",e),null}}async getVideoId(){const e=window.location.href.match(/[?&]v=([^&]+)/);return e?e[1]:null}};i(r,"instance");let d=r;class E{constructor(t){i(this,"container");i(this,"header");i(this,"content");i(this,"button");i(this,"buttonContainer");i(this,"sections",null);i(this,"activeTab","summary");this.container=t,this.header=this.createHeader(),this.content=new C,this.button=new f(()=>this.startSummarization()),this.buttonContainer=this.createButtonContainer(),this.init()}createHeader(){const t=document.createElement("div");t.className="youtube-summary-header";const e=document.createElement("div");e.className="youtube-summary-header-left";const s=document.createElement("span");s.textContent="Résumé de la vidéo",e.appendChild(s);const a=document.createElement("div");a.className="youtube-summary-header-center";const o=document.createElement("div");o.className="youtube-summary-tabs",[{key:"summary",icon:c.summary,text:"Résumé"},{key:"timestampedSummary",icon:c.key,text:"Points clés"},{key:"transcript",icon:c.transcript,text:"Transcription"}].forEach(({key:u,icon:y,text:g})=>{const m=document.createElement("div");m.className="youtube-summary-tab",u===this.activeTab&&m.classList.add("selected"),m.innerHTML=`${y} ${g}`,m.onclick=()=>this.switchTab(u),o.appendChild(m)}),a.appendChild(o);const h=document.createElement("div");h.className="youtube-summary-header-right";const l=document.createElement("div");return l.className="youtube-summary-action-button",l.innerHTML=`${c.comments} Top Comments`,h.appendChild(l),t.appendChild(e),t.appendChild(a),t.appendChild(h),t}createButtonContainer(){const t=document.createElement("div");return t.className="youtube-summary-button-container",t.appendChild(this.button.getElement()),t}init(){(getComputedStyle(document.documentElement).getPropertyValue("--yt-spec-base-background").trim()==="#0f0f0f"||window.matchMedia("(prefers-color-scheme: dark)").matches)&&this.container.classList.add("dark"),this.container.appendChild(this.header),this.container.appendChild(this.content.getElement()),this.container.appendChild(this.buttonContainer)}switchTab(t){if(!this.sections)return;const e=this.header.querySelectorAll(".youtube-summary-tab");e.forEach(a=>a.classList.remove("selected"));const s=Array.from(e).find(a=>{var o;return(o=a.textContent)==null?void 0:o.includes(t==="timestampedSummary"?"Points clés":t==="transcript"?"Transcription":"Résumé")});s&&s.classList.add("selected"),this.activeTab=t,this.renderSection(t)}async startSummarization(){try{this.container.style.height="600px",this.container.classList.add("expanded"),this.content.showLoading(),this.button.disable();const t=await d.getInstance().getVideoId();if(!t)throw new Error("Could not find video ID");const e=await d.getInstance().fetchSummary(t);if(!e)throw new Error("Failed to fetch summary");this.sections=e,this.renderSection(this.activeTab),this.button.hide()}catch(t){console.error("Error:",t),this.container.style.height="300px",this.container.classList.remove("expanded"),this.content.showError(t instanceof Error?t.message:"An error occurred"),this.button.enable()}}renderSection(t){if(!this.sections)return;const e=this.sections[t];this.content.render(e)}}function L(){return new URLSearchParams(window.location.search).get("v")}function x(){const n=document.createElement("div");return n.id="youtube-summary-container",n.className="youtube-summary-container",n}function z(){const n=document.querySelector("#secondary");if(!n)return;const t=document.createElement("div");t.className="youtube-summary-block-embedded";const e=document.createElement("div");e.className="youtube-summary-content-wrapper";const s=x();e.appendChild(s),t.appendChild(e),n.insertBefore(t,n.firstChild),new E(s)}function M(n,t=20){return new Promise(e=>{let s=0;const a=()=>{s++;const o=document.querySelector(n);if(o){e(o);return}if(s>=t){e(null);return}setTimeout(a,500)};a()})}async function v(){if(!L())return;if(await M("#secondary")){const e=document.querySelector(".youtube-summary-block-embedded");e&&e.remove(),z()}}let p=location.href;new MutationObserver(()=>{const n=location.href;n!==p&&(p=n,v())}).observe(document.body,{subtree:!0,childList:!0});v();
