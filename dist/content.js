var p=Object.defineProperty;var b=(i,t,e)=>t in i?p(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var o=(i,t,e)=>(b(i,typeof t!="symbol"?t+"":t,e),e);/* empty css      */class v{constructor(t){o(this,"element");o(this,"tabs");o(this,"onSectionChange");this.element=document.createElement("div"),this.element.className="youtube-summary-header",this.tabs=document.createElement("div"),this.tabs.className="youtube-summary-tabs",this.onSectionChange=t,this.init()}init(){const t=this.createLeftSection(),e=this.createCenterSection(),n=this.createRightSection();this.element.appendChild(t),this.element.appendChild(e),this.element.appendChild(n)}createLeftSection(){const t=document.createElement("div");return t.className="youtube-summary-header-left",t.innerHTML='<div class="eightify-logo" style="width:32px;height:32px;display:flex;align-items:center;justify-content:center;background:#fff;border-radius:10px;border:1.5px solid #e5e7eb;box-shadow:0 1px 4px 0 #0001;margin-right:8px;"><svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="22" height="22" rx="7" fill="#fff"/><path d="M11 4L17 11L11 18L5 11L11 4Z" fill="#111"/></svg></div>',t}createCenterSection(){const t=document.createElement("div");t.className="youtube-summary-header-center";const e=document.createElement("div");e.className="eightify-tabs";const n=["summary","timestampedSummary","transcript","comments"],r={summary:{icon:'<svg width="18" height="18" fill="none"><rect x="3" y="4" width="12" height="10" rx="2" fill="#bbb"/><rect x="5" y="6" width="8" height="1.5" rx="0.75" fill="#fff"/><rect x="5" y="9" width="6" height="1.5" rx="0.75" fill="#fff"/></svg>',tooltip:"Résumé"},timestampedSummary:{icon:'<svg width="18" height="18" fill="none"><circle cx="9" cy="9" r="7" stroke="#bbb" stroke-width="2"/><path d="M9 5v4l3 2" stroke="#bbb" stroke-width="1.5" stroke-linecap="round"/></svg>',tooltip:"Points clés"},transcript:{icon:'<svg width="18" height="18" fill="none"><rect x="4" y="5" width="10" height="8" rx="2" fill="#bbb"/><rect x="6" y="7" width="6" height="1.5" rx="0.75" fill="#fff"/><rect x="6" y="10" width="4" height="1.5" rx="0.75" fill="#fff"/></svg>',tooltip:"Transcription"},comments:{icon:'<svg width="18" height="18" fill="none"><ellipse cx="9" cy="8" rx="7" ry="5" stroke="#bbb" stroke-width="2"/><path d="M9 13c-3 0-5-1.5-5-3" stroke="#bbb" stroke-width="1.5"/><circle cx="7" cy="8" r="1" fill="#bbb"/><circle cx="9" cy="8" r="1" fill="#bbb"/><circle cx="11" cy="8" r="1" fill="#bbb"/></svg>',tooltip:"Commentaires"}};return n.forEach((s,u)=>{const c=document.createElement("div");c.className=`eightify-tab${u===0?" selected":""}`,c.title=r[s].tooltip,c.innerHTML=r[s].icon,c.onclick=()=>{e.querySelectorAll(".eightify-tab").forEach(g=>g.classList.remove("selected")),c.classList.add("selected"),this.onSectionChange(s)},e.appendChild(c)}),t.appendChild(e),t}createRightSection(){const t=document.createElement("div");return t.className="youtube-summary-header-right",t.innerHTML=`
      <button class="eightify-action" title="Like" style="background:none;border:none;padding:6px 8px;cursor:pointer;"><svg width="20" height="20" fill="none"><path d="M6 10l4 4 4-4" stroke="#bbb" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
      <button class="eightify-action" title="Share" style="background:none;border:none;padding:6px 8px;cursor:pointer;"><svg width="20" height="20" fill="none"><path d="M4 12v4a2 2 0 002 2h8a2 2 0 002-2v-4" stroke="#bbb" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M16 6l-4-4-4 4" stroke="#bbb" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
      <button class="eightify-action" title="Settings" style="background:none;border:none;padding:6px 8px;cursor:pointer;"><svg width="20" height="20" fill="none"><circle cx="10" cy="10" r="3" stroke="#bbb" stroke-width="2"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 01-2.83 2.83l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 007.1 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06a1.65 1.65 0 00.33-1.82A1.65 1.65 0 013 15V15a1.65 1.65 0 00-1.51-1H1a2 2 0 010-4h.09A1.65 1.65 0 003 7.1a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 007.1 4.6a1.65 1.65 0 001.82-.33L9 4.21A2 2 0 0113 4.21l-.06.06a1.65 1.65 0 001.82.33 1.65 1.65 0 001.51 1H19a2 2 0 010 4h-.09A1.65 1.65 0 0019.4 15z" stroke="#bbb" stroke-width="2"/></svg></button>
      <div class="eightify-avatar" style="width:28px;height:28px;border-radius:50%;overflow:hidden;margin-left:8px;"><img src="https://www.gravatar.com/avatar/?d=mp" alt="User" style="width:100%;height:100%;object-fit:cover;"/></div>
    `,t}getElement(){return this.element}}const l={brain:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 3c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2m0 10c3.3 0 6-2.7 6-6s-2.7-6-6-6-6 2.7-6 6 2.7 6 6 6m0-8c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2m8.4 15.7l-3.6-3.6c-.2-.2-.5-.3-.8-.3h-8c-.3 0-.6.1-.8.3l-3.6 3.6c-.3.3-.3.8 0 1.1.3.3.8.3 1.1 0l3.3-3.3h7.8l3.3 3.3c.3.3.8.3 1.1 0 .3-.3.3-.8 0-1.1z"/></svg>',summary:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M14 17h-7c-.6 0-1-.4-1-1s.4-1 1-1h7c.6 0 1 .4 1 1s-.4 1-1 1zm3-4h-10c-.6 0-1-.4-1-1s.4-1 1-1h10c.6 0 1 .4 1 1s-.4 1-1 1zm0-4h-10c-.6 0-1-.4-1-1s.4-1 1-1h10c.6 0 1 .4 1 1s-.4 1-1 1z"/></svg>',key:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12.65 10C11.83 7.67 9.61 6 7 6c-3.31 0-6 2.69-6 6s2.69 6 6 6c2.61 0 4.83-1.67 5.65-4H17v4h4v-4h2v-4H12.65zM7 14c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"/></svg>',transcript:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"/></svg>',comments:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M21 6h-2v9H6v2c0 .55.45 1 1 1h11l4 4V7c0-.55-.45-1-1-1zm-4 6V3c0-.55-.45-1-1-1H3c-.55 0-1 .45-1 1v14l4-4h10c.55 0 1-.45 1-1z"/></svg>',export:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M19 12v7H5v-7H3v7c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zm-6 .67l2.59-2.58L17 11.5l-5 5-5-5 1.41-1.41L11 12.67V3h2z"/></svg>',filter:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z"/></svg>',link:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/></svg>',text:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M2.5 4v3h5v12h3V7h5V4h-13zm19 5h-9v3h3v7h3v-7h3V9z"/></svg>',clock:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/></svg>'};class y{constructor(t){o(this,"button");this.button=document.createElement("button"),this.button.className="youtube-summary-button",this.button.innerHTML=`${l.brain} Résumer la vidéo`,this.button.onclick=t}getElement(){return this.button}disable(){this.button.disabled=!0,this.button.innerHTML=`${l.brain} Génération en cours...`}enable(){this.button.disabled=!1,this.button.innerHTML=`${l.brain} Résumer la vidéo`}hide(){this.button.style.display="none"}show(){this.button.style.display="flex"}}class w{constructor(){o(this,"element");o(this,"loadingElement");o(this,"contentList");this.element=document.createElement("div"),this.element.className="youtube-summary-content",this.loadingElement=this.createLoadingElement(),this.contentList=this.createContentList(),this.element.appendChild(this.loadingElement),this.element.appendChild(this.contentList)}createLoadingElement(){const t=document.createElement("div");t.className="youtube-summary-loading";const e=document.createElement("div");e.className="loading-spinner",t.appendChild(e);const n=document.createElement("div");return n.className="loading-text",n.textContent="Génération du résumé en cours...",t.appendChild(n),t}createContentList(){const t=document.createElement("ul");return t.className="youtube-summary-list",t}getElement(){return this.element}showLoading(){this.contentList.style.display="none",this.loadingElement.classList.add("show")}hideLoading(){this.loadingElement.classList.remove("show"),this.contentList.style.display="block"}render(t){this.hideLoading(),this.contentList.innerHTML="";const e=this.element.querySelector(".youtube-summary-loading-btn");e&&e.remove(),this.loadingElement&&this.loadingElement.parentElement&&this.loadingElement.parentElement.removeChild(this.loadingElement);let n=this.element.parentElement;if(n){const r=n.querySelector(".youtube-summary-button-container");r&&r.remove(),(n.classList.contains("youtube-summary-app")||n.id==="youtube-summary-container")&&(n.classList.add("expanded"),n.style.height="600px",n.style.maxHeight="600px")}t.forEach(r=>{const s=document.createElement("li");s.className="youtube-summary-item",s.textContent=r,this.contentList.appendChild(s)})}showError(t){this.hideLoading(),this.contentList.innerHTML=`
      <div class="youtube-summary-error">
        ${t}
      </div>
    `}}const a=class a{constructor(){o(this,"apiUrl","http://localhost:5000/api/summarize")}static getInstance(){return a.instance||(a.instance=new a),a.instance}async fetchSummary(t){try{const n=await(await fetch(this.apiUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({videoId:t,targetLang:"fr"})})).json();return{summary:Array.isArray(n.summary)?n.summary:n.summary.split(`
`).map(s=>s.trim()).filter(s=>s.length>0),timestampedSummary:["00:00 Introduction","00:30 Faits importants","01:10 Analyse politique"],transcript:["00:00 Lorem ipsum dolor sit amet...","00:41 Consectetur adipiscing elit...","01:22 Sed do eiusmod tempor incididunt..."],comments:["Super vidéo, très instructif !","Excellente analyse des événements.","Merci pour ces explications détaillées."]}}catch(e){return console.error("Erreur lors de la récupération du résumé :",e),null}}async getVideoId(){const e=window.location.href.match(/[?&]v=([^&]+)/);return e?e[1]:null}};o(a,"instance");let h=a;class f{constructor(t){o(this,"container");o(this,"header");o(this,"content");o(this,"button");o(this,"buttonContainer");o(this,"sections",null);o(this,"activeTab","summary");this.container=t,this.header=new v(e=>this.switchTab(e)).getElement(),this.content=new w,this.button=new y(()=>this.startSummarization()),this.buttonContainer=this.createButtonContainer(),this.init()}createButtonContainer(){const t=document.createElement("div");return t.className="youtube-summary-button-container",t.appendChild(this.button.getElement()),t}init(){(getComputedStyle(document.documentElement).getPropertyValue("--yt-spec-base-background").trim()==="#0f0f0f"||window.matchMedia("(prefers-color-scheme: dark)").matches)&&this.container.classList.add("dark"),this.container.appendChild(this.header),this.container.appendChild(this.content.getElement()),this.container.appendChild(this.buttonContainer)}switchTab(t){if(!this.sections)return;const e=this.header.querySelectorAll(".youtube-summary-tab");e.forEach(r=>r.classList.remove("selected"));const n=Array.from(e).find(r=>{var s;return(s=r.textContent)==null?void 0:s.includes(t==="timestampedSummary"?"Points clés":t==="transcript"?"Transcription":"Résumé")});n&&n.classList.add("selected"),this.activeTab=t,this.renderSection(t)}async startSummarization(){try{this.container.style.height="600px",this.container.classList.add("expanded"),this.content.showLoading(),this.button.disable();const t=await h.getInstance().getVideoId();if(!t)throw new Error("Could not find video ID");const e=await h.getInstance().fetchSummary(t);if(!e)throw new Error("Failed to fetch summary");this.sections=e,this.renderSection(this.activeTab),this.button.hide()}catch(t){console.error("Error:",t),this.container.style.height="300px",this.container.classList.remove("expanded"),this.content.showError(t instanceof Error?t.message:"An error occurred"),this.button.enable()}}renderSection(t){if(!this.sections)return;const e=this.sections[t];this.content.render(e),this.buttonContainer&&this.buttonContainer.parentElement&&this.buttonContainer.parentElement.removeChild(this.buttonContainer)}}function x(){return new URLSearchParams(window.location.search).get("v")}function E(){const i=document.createElement("div");return i.id="youtube-summary-container",i.className="youtube-summary-container",i}function C(){const i=document.querySelector("#secondary");if(!i)return;const t=document.createElement("div");t.className="youtube-summary-block-embedded";const e=document.createElement("div");e.className="youtube-summary-content-wrapper";const n=E();e.appendChild(n),t.appendChild(e),i.insertBefore(t,i.firstChild),new f(n)}function L(i,t=20){return new Promise(e=>{let n=0;const r=()=>{n++;const s=document.querySelector(i);if(s){e(s);return}if(n>=t){e(null);return}setTimeout(r,500)};r()})}async function m(){if(!x())return;if(await L("#secondary")){const e=document.querySelector(".youtube-summary-block-embedded");e&&e.remove(),C()}}let d=location.href;new MutationObserver(()=>{const i=location.href;i!==d&&(d=i,m())}).observe(document.body,{subtree:!0,childList:!0});m();
